let detailPopupTl=null;const buildDetailPopupAnimation=()=>{const t=gsap.timeline({paused:!0});return t.from("#detailPopup #title",{opacity:0,y:-20,duration:.5,ease:"power2.out"}),t.from("#detailPopup #detail",{opacity:0,y:-20,duration:.5,ease:"power2.out"},"-=0.4"),t.from("#detailPopup #info",{opacity:0,y:-20,duration:.5,ease:"power2.out"},"-=0.4"),t.from("#detailPopup #socials a",{opacity:0,scale:.8,duration:.3,stagger:.05,ease:"back.out(1.7)"},"-=0.3"),t.from("#detailPopup img",{opacity:0,scale:1.1,duration:1.2,ease:"power2.out"},"-=0.5"),t.from("#detailPopup #closeButton",{opacity:0,scale:.8,duration:.3,ease:"back.out(1.7)"},"-=0.3"),t};document.addEventListener("alpine:init",()=>{Alpine.store("detailPopup",{fetchingId:null,itemData:null,show:!1,touchStartY:0,lastTouchY:0,touchDeltaY:0,velocityY:0,isDragging:!1,translateY:0,content:null,async init(){await new Promise(t=>setTimeout(t,100)),this.content=document.getElementById("detail-popup-content")},async open(t,e){if(this.resetTouchScroll(),this.fetchingId==t)return;if(this.itemData&&this.itemData.id==t)return void(this.show=!0);this.itemData=null,this.show=!0,this.fetchingId=t;const o=document.documentElement.lang||"de";console.log("Opening detail popup for ID:",t,"Template:",e,"Language:",o),detailPopupTl||(detailPopupTl=buildDetailPopupAnimation()),detailPopupTl.progress(0).pause(),await new Promise(t=>setTimeout(t,200));try{const i=await fetch(`/api/item/${e}/${t}/${o}`);if(!i.ok)throw new Error("Network response was not ok");const a=await i.json();this.itemData=a,console.log("Fetched item data:",this.itemData),await new Promise(t=>requestAnimationFrame(t)),detailPopupTl.play()}catch(t){console.error("Error fetching item data:",t)}finally{this.fetchingId=null}},handleTouchStart(t){0===this.content.scrollTop&&(this.resetTouchScroll(),this.isDragging=!0,this.touchStartY=t.touches[0].clientY,this.lastTouchY=this.touchStartY)},handleTouchMove(t){if(0!==this.content.scrollTop)return;const e=t.touches[0].clientY;this.touchDeltaY=e-this.touchStartY;const o=e-this.lastTouchY;this.lastTouchY=e,this.velocityY=o,this.touchDeltaY>0?this.translateY=this.touchDeltaY:this.translateY=0},handleTouchEnd(){0===this.content.scrollTop&&(this.isDragging=!1,this.touchDeltaY>150||this.velocityY>10?gsap.to(this,{translateY:window.innerHeight,duration:.3,ease:"power2.out",onComplete:()=>this.close()}):gsap.to(this,{translateY:0,duration:.3,ease:"power2.out"}),this.resetTouchScroll())},async close(){this.show=!1},resetTouchScroll(){this.isDragging=!1,this.translateY=0,this.touchStartY=0,this.lastTouchY=0,this.touchDeltaY=0,this.velocityY=0}})});